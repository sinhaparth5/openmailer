function togglePasswordVisibility(){const e=document.getElementById("password"),t=document.getElementById("eyeIcon"),n=document.getElementById("eyeSlashIcon"),s=document.getElementById("togglePasswordButton");"password"===e.type?(e.type="text",t.classList.add("hidden"),n.classList.remove("hidden"),s.setAttribute("aria-label","Hide password"),s.setAttribute("aria-pressed","true")):(e.type="password",t.classList.remove("hidden"),n.classList.add("hidden"),s.setAttribute("aria-label","Show password"),s.setAttribute("aria-pressed","false"))}function toggleTwoFactor(){const e=document.getElementById("twoFactorSection"),t=document.getElementById("twoFactorToggle"),n=e.classList.contains("hidden");e.classList.toggle("hidden"),t.setAttribute("aria-expanded",n?"true":"false"),n&&setTimeout(()=>{document.getElementById("twoFactorCode").focus()},100)}function showAlert(e,t="error"){const n=document.getElementById("alertContainer"),s=document.getElementById("alertBox"),o=document.getElementById("alertIcon"),d=document.getElementById("alertMessage");n.classList.remove("hidden"),d.textContent=e,"error"===t?(s.className="rounded-lg p-4 bg-red-50 border border-red-200",o.className="w-5 h-5 flex-shrink-0 mr-3 mt-0.5 text-red-600",o.innerHTML='<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>'):"success"===t&&(s.className="rounded-lg p-4 bg-green-50 border border-green-200",o.className="w-5 h-5 flex-shrink-0 mr-3 mt-0.5 text-green-600",o.innerHTML='<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>')}function hideAlert(){document.getElementById("alertContainer").classList.add("hidden")}document.getElementById("loginForm").addEventListener("submit",async e=>{e.preventDefault(),hideAlert();const t=document.getElementById("submitButton"),n=document.getElementById("buttonText"),s=document.getElementById("loadingSpinner"),o=document.getElementById("email").value,d=document.getElementById("password").value,a=document.getElementById("twoFactorCode").value||null,r=document.getElementById("rememberMe").checked,l={email:o,password:d};a&&6===a.length&&(l.twoFactorCode=a),t.disabled=!0,t.setAttribute("aria-busy","true"),n.textContent="Signing in...",s.classList.remove("hidden");const i=document.getElementById("loadingText");i&&i.classList.remove("hidden");try{const e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),t=await e.json();if(e.ok&&t.success)t.data.accessToken&&(r?(localStorage.setItem("accessToken",t.data.accessToken),t.data.refreshToken&&localStorage.setItem("refreshToken",t.data.refreshToken)):(sessionStorage.setItem("accessToken",t.data.accessToken),t.data.refreshToken&&sessionStorage.setItem("refreshToken",t.data.refreshToken))),showAlert("Login successful! Redirecting...","success"),setTimeout(()=>{window.location.href="/"},1e3);else{showAlert(t.message||"Login failed. Please check your credentials.","error")}}catch(e){console.error("Login error:",e),showAlert("An error occurred. Please try again later.","error")}finally{t.disabled=!1,t.setAttribute("aria-busy","false"),n.textContent="Sign In",s.classList.add("hidden");const e=document.getElementById("loadingText");e&&e.classList.add("hidden")}});