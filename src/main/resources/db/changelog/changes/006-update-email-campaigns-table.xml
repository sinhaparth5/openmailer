<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="006-add-email-campaign-columns" author="openmailer">
        <!-- Add sender information -->
        <addColumn tableName="email_campaigns">
            <column name="from_name" type="VARCHAR(255)"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="from_email" type="VARCHAR(255)"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="reply_to_email" type="VARCHAR(255)"/>
        </addColumn>

        <!-- Add foreign keys (will be created after those tables exist) -->
        <addColumn tableName="email_campaigns">
            <column name="domain_id" type="BIGINT"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="provider_id" type="BIGINT"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="list_id" type="BIGINT"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="segment_id" type="BIGINT"/>
        </addColumn>

        <!-- Add content fields -->
        <addColumn tableName="email_campaigns">
            <column name="subject_line" type="VARCHAR(500)"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="preview_text" type="VARCHAR(255)"/>
        </addColumn>

        <!-- Add tracking options -->
        <addColumn tableName="email_campaigns">
            <column name="track_opens" type="BOOLEAN" defaultValueBoolean="true"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="track_clicks" type="BOOLEAN" defaultValueBoolean="true"/>
        </addColumn>

        <!-- Add analytics fields -->
        <addColumn tableName="email_campaigns">
            <column name="open_rate" type="DECIMAL(5,2)" defaultValueNumeric="0"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="click_rate" type="DECIMAL(5,2)" defaultValueNumeric="0"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="bounce_rate" type="DECIMAL(5,2)" defaultValueNumeric="0"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="unsubscribe_count" type="INT" defaultValueNumeric="0"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="complaint_count" type="INT" defaultValueNumeric="0"/>
        </addColumn>

        <!-- Add sending options -->
        <addColumn tableName="email_campaigns">
            <column name="send_speed" type="INT" defaultValueNumeric="100"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="retry_failed" type="BOOLEAN" defaultValueBoolean="true"/>
        </addColumn>

        <addColumn tableName="email_campaigns">
            <column name="max_retries" type="INT" defaultValueNumeric="3"/>
        </addColumn>
    </changeSet>

</databaseChangeLog>
